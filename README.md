Cистема обработки транзакций платёжной системы
======================================================================
Краткое описание
----------------
Этот проект представляет собой систему обработки транзакций для платёжной системы, реализованную в виде HTTP сервера с REST API на языке Go. Он включает в себя три основных метода: **Send**, **GetLast**, и **GetBalance**.

Проект реализует базовые функции платёжной системы с использованием SQLite в качестве базы данных. В проекте используется Docker для контейнеризации и развертывания приложения. В качестве серверного фреймворка применяется стандартный HTTP сервер на Go. В проекте обеспечены все требования безопасности, персистентности данных и корректной работы с базой данных.

Структура проекта
-----------------

    infotecs_transaction_system/
    ├── build/
    │   └── Dockerfile                          # Dockerfile для сборки приложения
    ├── cmd/
    │   └── main.go                             # Главный файл, точка входа в приложение
    ├── deployments/
    │   └── docker-compose.yml                  # Docker-compose файл для развертывания приложения
    ├── internal/
    │   ├── api/
    │   │   ├── handlers/
    │   │   │   ├── balance.go                  # Обработчик для получения баланса
    │   │   │   ├── errors.go                   # Обработка кастомных ошибок
    │   │   │   ├── send.go                     # Обработчик для отправки средств
    │   │   │   └── transactions.go             # Обработчик для получения N последних транзакций
    │   │   ├── handler.go                      # Регистрация маршрутов
    │   │   └── server.go                       # Сервер
    │   ├── dto/
    │   │   ├── transactions.go                 # DTO для взаимодействия с транзакциями
    │   │   └── wallets.go                      # DTO для взаимодействия с кошельками
    │   ├── services/
    │   │   ├── errors.go                       # Кастомные ошибки сервисного слоя
    │   │   ├── services.go                     # Объединение и инициализация сервисов
    │   │   └── transfer.go                     # Сервис по работе с кошельками и транзакциями
    │   └── storage/
    │       ├── assets/                         # SQL-запросы к БД
    │       │   ├── transactions/
    │       │   │   ├── get_last_n.sql
    │       │   │   └── insert.sql
    │       │   └── wallets/
    │       │       ├── get_balance.sql
    │       │       ├── get_count.sql
    │       │       ├── insert.sql
    │       │       └── update_balance.sql
    │       ├── errors.go                       # Кастомные ошибки слоя хранения
    │       ├── executor.go                     # Интерфейс для выполнения SQL-запросов
    │       ├── storage.go                      # Объединение и инициализация репозиториев
    │       ├── transactions.go                 # Работа с таблицей транзакций в БД
    │       └── wallets.go                      # Работа с таблицей кошельков в БД
    ├── migrations/                             # Миграции для базы данных
    │   ├── 000001_create_tables.up.sql
    │   └── 000001_create_tables.down.sql
    ├── database.db                             # База данных SQLite
    ├── go.mod                                  # Файл зависимостей Go-модуля
    ├── go.sum                                  # Контрольные суммы зависимостей
    ├── .dockerignore                           # Игнорируемые Docker'ом файлы
    ├── .gitignore                              # Игнорируемые Git'ом файлы
    └── README.md                               # Документация проекта


Инициализация проекта
---------------------

Для начала работы с проектом выполните следующие шаги:

1.  Клонируйте репозиторий на свой компьютер:

git clone [https://github.com/coffee-realist/infotecs_transaction_system](https://github.com/coffee-realist/infotecs_transaction_system)

2. Перейдите в директорию проекта:

        cd infotecs_transaction_system

3. Убедитесь, что у вас установлен Go (обязательно) и Docker (опционально: для запуска проекта через Docker).

4. Запустите установку зависимостей для модулей Go: 

        go mod tidy


Миграции в БД
--------

Миграции для базы данных хранятся в папке **migrations/**. В проекте используется библиотека **golang-migrate** для применения миграций. При первом запуске приложения автоматически создается база данных и применяется первая миграция, если она не была выполнена.

Запуск без Docker
-----------------

Если вы хотите запустить приложение без Docker, выполните следующие шаги:

1.  Убедитесь, что у вас установлен Go.
2.  Запустите приложение запуском файла main.go или с помощью команды из корня проекта:


    go run cmd/main.go


3.  Приложение будет доступно по адресу [http://localhost:8080](http://localhost:8080).

Запуск через Docker
-------------------

Для того чтобы запустить проект в Docker, выполните следующие шаги:

1.  Убедитесь, что у вас установлен Docker и Docker Compose.
2.  Перейдите в директорию проекта.
3.  Если в корневой папке отсутствует файл **database.db**, то создайте пустой файл с таким именем (при запуске через Docker необходимо наличие уже созданной ранее БД или же пустого файла с именем БД - database.db).
4.  Перейдите в папку deployments


    cd deployments

5. Запустите контейнер с приложением:


    docker-compose up --build

5.  После этого сервер будет доступен по адресу [http://localhost:8080](http://localhost:8080).


API
---
Для проверки работоспособности методов наиболее удобно будет использовать postman (необходимо установить).

В качестве аналога можете воспользоваться консольной утилитой curl.

### 1\. POST /api/send

Этот метод отправляет средства с одного кошелька на другой. В теле запроса должен быть передан JSON-объект с полями:

    {
        "from": "e240d825d255af751f5f55af8d9671beabdf2236c0a3b4e2639b3e182d994c88", # заменить на действительный
        "to": "d8f3c7d85256d94d5569a3b61f7d2b10720a6b5f53cfce08597d8a410c4d7bfa",   # заменить на действительный
        "amount": 3.50                                                              # десятичное число > 0
    }


В случае успешной транзакции возвращается 201 Created, в случае недостаточного баланса или неверно сформированного запроса – ошибка 400.

Если кошелек не будет найден, то будет возвращена ошибка 404.

### 2\. GET /api/transactions?count=N

Этот метод возвращает N последних транзакций. Пример:

    GET /api/transactions?count=5


Ответ возвращает массив JSON с последними транзакциями.

### 3\. GET /api/wallet/{address}/balance

Этот метод возвращает баланс указанного кошелька. Пример:

    GET /api/wallet/e240d825d255af751f5f55af8d9671beabdf2236c0a3b4e2639b3e182d994c88/balance     
                     # заменить номер кошелька на действительный


Ответ возвращает код 200 OK и JSON с балансом кошелька.

Также может быть возвращена ошибка 404, если такого кошелька не существует, либо ошибка 400, если запрос сформирован неверно.

Требования
----------

*   Go 1.24.5 или выше.
*   Docker (для запуска через Docker Compose).
